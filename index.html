<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Virtual Try-On</title>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18",
          "react-dom/client": "https://esm.sh/react-dom@18/client",
          "framer-motion": "https://esm.sh/framer-motion@10"
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>

    <script type="module">
      import React, { useState } from "react";
      import ReactDOM from "react-dom/client";
      import { AnimatePresence, motion } from "framer-motion";

      const Spinner = () => <div className="animate-spin">‚è≥</div>;

      const Canvas = ({
        displayImageUrl,
        onStartOver,
        isLoading,
        loadingMessage,
        onSelectPose,
        poseInstructions,
        currentPoseIndex,
        availablePoseKeys
      }) => {
        const [isPoseMenuOpen, setIsPoseMenuOpen] = useState(false);

        const handlePreviousPose = () => {
          if (isLoading || availablePoseKeys.length <= 1) return;
          const currentPoseInstruction = poseInstructions[currentPoseIndex];
          const currentIndexInAvailable =
            availablePoseKeys.indexOf(currentPoseInstruction);
          if (currentIndexInAvailable === -1) {
            onSelectPose(
              (currentPoseIndex - 1 + poseInstructions.length) %
                poseInstructions.length
            );
            return;
          }
          const prevIndexInAvailable =
            (currentIndexInAvailable - 1 + availablePoseKeys.length) %
            availablePoseKeys.length;
          const prevPoseInstruction = availablePoseKeys[prevIndexInAvailable];
          const newGlobalPoseIndex =
            poseInstructions.indexOf(prevPoseInstruction);
          if (newGlobalPoseIndex !== -1) {
            onSelectPose(newGlobalPoseIndex);
          }
        };

        const handleNextPose = () => {
          if (isLoading) return;
          const currentPoseInstruction = poseInstructions[currentPoseIndex];
          const currentIndexInAvailable =
            availablePoseKeys.indexOf(currentPoseInstruction);
          if (currentIndexInAvailable === -1 || availablePoseKeys.length === 0) {
            onSelectPose((currentPoseIndex + 1) % poseInstructions.length);
            return;
          }
          const nextIndexInAvailable = currentIndexInAvailable + 1;
          if (nextIndexInAvailable < availablePoseKeys.length) {
            const nextPoseInstruction =
              availablePoseKeys[nextIndexInAvailable];
            const newGlobalPoseIndex =
              poseInstructions.indexOf(nextPoseInstruction);
            if (newGlobalPoseIndex !== -1) {
              onSelectPose(newGlobalPoseIndex);
            }
          } else {
            const newGlobalPoseIndex =
              (currentPoseIndex + 1) % poseInstructions.length;
            onSelectPose(newGlobalPoseIndex);
          }
        };

        return (
          <div className="w-full h-full flex items-center justify-center">
            <button onClick={onStartOver}>üîÑ Start Over</button>
            {displayImageUrl ? (
              <img src={displayImageUrl} alt="Virtual try-on" />
            ) : (
              <Spinner />
            )}
            <div>
              <button onClick={handlePreviousPose}>‚¨ÖÔ∏è</button>
              <span>{poseInstructions[currentPoseIndex]}</span>
              <button onClick={handleNextPose}>‚û°Ô∏è</button>
            </div>
          </div>
        );
      };

      const App = () => (
        <Canvas
          displayImageUrl={null}
          onStartOver={() => alert("Restart!")}
          isLoading={false}
          loadingMessage="Loading..."
          onSelectPose={(i) => console.log("Pose", i)}
          poseInstructions={["Pose 1", "Pose 2", "Pose 3"]}
          currentPoseIndex={0}
          availablePoseKeys={["Pose 1"]}
        />
      );

      ReactDOM.createRoot(document.getElementById("root")).render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>
